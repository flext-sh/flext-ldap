#!/usr/bin/env python3
"""Real coverage tests for flext_ldap.exceptions module.

This module provides comprehensive test coverage for LDAP exception hierarchy,
testing all real functionality without mocks to ensure error handling works correctly.

Architecture tested:
- FlextLDAPError: Base exception with LDAP context and codes
- FlextLDAPConnectionError: Connection-specific errors
- FlextLDAPAuthenticationError: Authentication failures
- FlextLDAPSearchError: Search operation failures
- FlextLDAPOperationError: General LDAP operation failures
- FlextLDAPUserError: User management errors
- FlextLDAPGroupError: Group management errors
- FlextLDAPValidationError: Data validation errors
- FlextLDAPConfigurationError: Configuration issues
- FlextLDAPTypeError: Type-related errors
- FlextLDAPExceptionFactory: Factory for consistent error creation

Test Strategy: REAL functionality tests without mocks, testing actual exception
creation, error context, inheritance hierarchy, and factory methods.
"""

from __future__ import annotations

import unittest

from flext_core.exceptions import FlextExceptions.Error

from flext_ldap.exceptions import (
    FlextLDAPAuthenticationError,
    FlextLDAPConfigurationError,
    FlextLDAPConnectionError,
    FlextLDAPError,
    FlextLDAPExceptionFactory,
    FlextLDAPGroupError,
    FlextLDAPOperationError,
    FlextLDAPSearchError,
    FlextLDAPTypeError,
    FlextLDAPUserError,
    FlextLDAPValidationError,
)


class TestFlextLDAPErrorRealCoverage(unittest.TestCase):
    """Test FlextLDAPError base exception with real functionality coverage."""

    def test_flext_ldap_error_basic_creation(self) -> None:
        """Test FlextLDAPError creation with basic message."""
        # Execute REAL exception creation
        error = FlextLDAPError("Basic LDAP error message")

        # Verify REAL exception properties
        assert str(error) == "[LDAP_ERROR] Basic LDAP error message"
        assert error.message == "Basic LDAP error message"
        assert isinstance(error, FlextExceptions.Error)
        assert isinstance(error, Exception)

    def test_flext_ldap_error_with_ldap_context(self) -> None:
        """Test FlextLDAPError creation with LDAP context."""
        # Setup REAL LDAP context
        ldap_context = {
            "server": "ldap.example.com",
            "port": 389,
            "base_dn": "dc=example,dc=com",
            "bind_dn": "cn=REDACTED_LDAP_BIND_PASSWORD,dc=example,dc=com",
        }

        # Execute REAL exception creation with context
        error = FlextLDAPError(
            "LDAP operation failed",
            ldap_context=ldap_context,
            ldap_result_code="49",
            operation="bind",
        )

        # Verify REAL context preservation
        assert error.ldap_context == ldap_context
        assert error.ldap_result_code == "49"
        assert error.operation == "bind"

    def test_flext_ldap_error_with_error_code(self) -> None:
        """Test FlextLDAPError creation with error code."""
        # Execute REAL exception creation with error code
        error = FlextLDAPError(
            "Authentication failed", error_code="AUTH_FAILED", ldap_result_code="49"
        )

        # Verify REAL error code handling
        assert error.error_code == "AUTH_FAILED"
        assert error.ldap_result_code == "49"

    def test_flext_ldap_error_inheritance_hierarchy(self) -> None:
        """Test FlextLDAPError inheritance from FlextExceptions.Error."""
        # Execute REAL inheritance verification
        error = FlextLDAPError("Test inheritance")

        # Verify REAL inheritance chain
        assert isinstance(error, FlextLDAPError)
        assert isinstance(error, FlextExceptions.Error)
        assert isinstance(error, Exception)
        assert isinstance(error, BaseException)

    def test_flext_ldap_error_string_representation(self) -> None:
        """Test FlextLDAPError string representation."""
        # Execute REAL string representation
        error = FlextLDAPError("String representation test")

        # Verify REAL string methods
        assert str(error) == "[LDAP_ERROR] String representation test"
        assert repr(error).startswith("FlextLDAPError(")
        assert "String representation test" in repr(error)


class TestFlextLDAPConnectionErrorRealCoverage(unittest.TestCase):
    """Test FlextLDAPConnectionError with real functionality coverage."""

    def test_connection_error_basic_creation(self) -> None:
        """Test FlextLDAPConnectionError creation."""
        # Execute REAL connection error creation
        error = FlextLDAPConnectionError("Connection failed")

        # Verify REAL connection error properties
        assert str(error) == "[LDAP_CONNECTION_ERROR] Connection failed | Operation: connection"
        assert isinstance(error, FlextLDAPConnectionError)
        assert isinstance(error, FlextLDAPError)

    def test_connection_error_with_server_context(self) -> None:
        """Test FlextLDAPConnectionError with server context."""
        # Execute REAL connection error with server parameters
        error = FlextLDAPConnectionError(
            "Failed to connect to LDAP server",
            server_uri="ldap://ldap.example.com:389",
            timeout=30,
            retry_count=3,
        )

        # Verify REAL server context handling
        assert error.ldap_context is not None
        assert error.operation == "connection"

    def test_connection_error_with_parameters(self) -> None:
        """Test FlextLDAPConnectionError with all parameters."""
        # Execute REAL connection error with all parameters
        error = FlextLDAPConnectionError(
            "Connection timeout",
            server_uri="ldap://ldap.example.com:389",
            timeout=30,
            retry_count=3,
        )

        # Verify REAL parameter handling
        assert "Connection timeout" in str(error)
        assert isinstance(error, FlextLDAPConnectionError)
        assert error.ldap_context is not None


class TestFlextLDAPAuthenticationErrorRealCoverage(unittest.TestCase):
    """Test FlextLDAPAuthenticationError with real functionality coverage."""

    def test_authentication_error_basic_creation(self) -> None:
        """Test FlextLDAPAuthenticationError creation."""
        # Execute REAL authentication error creation
        error = FlextLDAPAuthenticationError("Authentication failed")

        # Verify REAL authentication error properties
        assert str(error) == "[LDAP_AUTH_ERROR] Authentication failed | Operation: authentication"
        assert isinstance(error, FlextLDAPAuthenticationError)
        assert isinstance(error, FlextLDAPError)

    def test_authentication_error_with_credentials(self) -> None:
        """Test FlextLDAPAuthenticationError with credentials context."""
        # Execute REAL authentication error with bind DN
        error = FlextLDAPAuthenticationError(
            "Invalid credentials provided",
            bind_dn="cn=REDACTED_LDAP_BIND_PASSWORD,dc=example,dc=com",
            ldap_result_code="49",
        )

        # Verify REAL credentials context handling
        assert error.ldap_context is not None
        assert error.ldap_result_code == "49"
        assert error.operation == "authentication"

    def test_authentication_error_with_parameters(self) -> None:
        """Test FlextLDAPAuthenticationError with all parameters."""
        # Execute REAL authentication error with all parameters
        error1 = FlextLDAPAuthenticationError(
            "Authentication failed", bind_dn="cn=user,dc=example,dc=com"
        )
        error2 = FlextLDAPAuthenticationError(
            "Bind failure", bind_dn="cn=REDACTED_LDAP_BIND_PASSWORD,dc=example,dc=com", ldap_result_code="49"
        )

        # Verify REAL parameter handling
        assert isinstance(error1, FlextLDAPAuthenticationError)
        assert isinstance(error2, FlextLDAPAuthenticationError)
        assert error2.ldap_result_code == "49"


class TestFlextLDAPSearchErrorRealCoverage(unittest.TestCase):
    """Test FlextLDAPSearchError with real functionality coverage."""

    def test_search_error_basic_creation(self) -> None:
        """Test FlextLDAPSearchError creation."""
        # Execute REAL search error creation
        error = FlextLDAPSearchError("Search operation failed")

        # Verify REAL search error properties
        assert str(error) == "[LDAP_SEARCH_ERROR] Search operation failed | Operation: search"
        assert isinstance(error, FlextLDAPSearchError)
        assert isinstance(error, FlextLDAPError)

    def test_search_error_with_search_context(self) -> None:
        """Test FlextLDAPSearchError with search parameters."""
        # Setup REAL search context
        search_context = {
            "base_dn": "ou=users,dc=example,dc=com",
            "filter": "(objectClass=person)",
            "scope": "subtree",
            "attributes": ["cn", "mail", "uid"],
        }

        # Execute REAL search error with context
        error = FlextLDAPSearchError(
            "Search filter invalid", ldap_context=search_context, operation="search"
        )

        # Verify REAL search context handling
        assert error.ldap_context == search_context
        assert error.operation == "search"

    def test_search_error_with_parameters(self) -> None:
        """Test FlextLDAPSearchError with parameters."""
        # Execute REAL search error with parameters
        error1 = FlextLDAPSearchError("Invalid filter", search_filter="(invalidFilter")
        error2 = FlextLDAPSearchError(
            "Base DN not found", base_dn="ou=missing,dc=example,dc=com"
        )
        error3 = FlextLDAPSearchError(
            "Search failed", scope="subtree", ldap_result_code="87"
        )

        # Verify REAL parameter handling
        assert isinstance(error1, FlextLDAPSearchError)
        assert isinstance(error2, FlextLDAPSearchError)
        assert isinstance(error3, FlextLDAPSearchError)


class TestFlextLDAPOperationErrorRealCoverage(unittest.TestCase):
    """Test FlextLDAPOperationError with real functionality coverage."""

    def test_operation_error_basic_creation(self) -> None:
        """Test FlextLDAPOperationError creation."""
        # Execute REAL operation error creation
        error = FlextLDAPOperationError("LDAP operation failed")

        # Verify REAL operation error properties
        assert str(error) == "[LDAP_OPERATION_ERROR] LDAP operation failed | Operation: operation"
        assert isinstance(error, FlextLDAPOperationError)
        assert isinstance(error, FlextLDAPError)

    def test_operation_error_with_operation_context(self) -> None:
        """Test FlextLDAPOperationError with operation details."""
        # Setup REAL operation context
        operation_context = {
            "operation_type": "modify",
            "target_dn": "cn=user,ou=users,dc=example,dc=com",
            "attributes": {"mail": "new@example.com"},
            "timestamp": "2025-08-23T10:30:00Z",
        }

        # Execute REAL operation error with context
        error = FlextLDAPOperationError(
            "Modify operation failed",
            ldap_context=operation_context,
            ldap_result_code="50",
            operation="modify",
        )

        # Verify REAL operation context handling
        assert error.ldap_context == operation_context
        assert error.ldap_result_code == "50"
        assert error.operation == "modify"

    def test_operation_error_factory_methods(self) -> None:
        """Test FlextLDAPOperationError creation."""
        # Create REAL FlextLDAPOperationError instances directly
        error1 = FlextLDAPOperationError(
            "Add operation failed", 
            operation_type="add",
            target_dn="cn=newuser,ou=users,dc=example,dc=com"
        )
        error2 = FlextLDAPOperationError(
            "Modify operation failed",
            operation_type="modify", 
            target_dn="cn=user,ou=users,dc=example,dc=com"
        )
        error3 = FlextLDAPOperationError(
            "Delete operation failed",
            operation_type="delete",
            target_dn="cn=olduser,ou=users,dc=example,dc=com"
        )

        # Verify REAL operation error results
        assert "cn=newuser,ou=users,dc=example,dc=com" in str(error1)
        assert isinstance(error1, FlextLDAPOperationError)

        assert "cn=user,ou=users,dc=example,dc=com" in str(error2)
        assert "50" in str(error2)
        assert isinstance(error2, FlextLDAPOperationError)

        assert "cn=olduser,ou=users,dc=example,dc=com" in str(error3)
        assert isinstance(error3, FlextLDAPOperationError)


class TestFlextLDAPUserErrorRealCoverage(unittest.TestCase):
    """Test FlextLDAPUserError with real functionality coverage."""

    def test_user_error_basic_creation(self) -> None:
        """Test FlextLDAPUserError creation."""
        # Execute REAL user error creation
        error = FlextLDAPUserError("User operation failed")

        # Verify REAL user error properties
        assert str(error) == "[LDAP_USER_ERROR] User operation failed | Operation: user_management"
        assert isinstance(error, FlextLDAPUserError)
        assert isinstance(error, FlextLDAPError)

    def test_user_error_with_user_context(self) -> None:
        """Test FlextLDAPUserError with user details."""
        # Setup REAL user context
        user_context = {
            "user_dn": "cn=john.doe,ou=users,dc=example,dc=com",
            "uid": "john.doe",
            "cn": "John Doe",
            "mail": "john.doe@example.com",
        }

        # Execute REAL user error with available parameters
        error = FlextLDAPUserError(
            "User creation failed", 
            user_dn="cn=john.doe,ou=users,dc=example,dc=com",
            uid="john.doe"
        )

        # Verify REAL user error attributes
        assert error.user_dn == "cn=john.doe,ou=users,dc=example,dc=com"
        assert error.uid == "john.doe"
        assert "User creation failed" in str(error)

    def test_user_error_factory_methods(self) -> None:
        """Test FlextLDAPExceptionFactory user error methods."""
        # Execute REAL factory methods that exist
        error1 = FlextLDAPExceptionFactory.user_creation_failed("cn=john.doe,ou=users,dc=example,dc=com", "User creation failed")
        error2 = FlextLDAPExceptionFactory.validation_failed("jane.smith", "Invalid user data")
        
        # Create direct FlextLDAPUserError for testing
        error3 = FlextLDAPUserError("Missing required field", uid="testuser", validation_field="mail")

        # Verify REAL factory method results
        assert "john.doe" in str(error1)
        assert isinstance(error1, FlextLDAPUserError)

        assert "jane.smith" in str(error2)
        assert isinstance(error2, FlextLDAPValidationError)

        assert "missing required field: mail" in str(error3)
        assert isinstance(error3, FlextLDAPUserError)


class TestFlextLDAPGroupErrorRealCoverage(unittest.TestCase):
    """Test FlextLDAPGroupError with real functionality coverage."""

    def test_group_error_basic_creation(self) -> None:
        """Test FlextLDAPGroupError creation."""
        # Execute REAL group error creation
        error = FlextLDAPGroupError("Group operation failed")

        # Verify REAL group error properties
        assert str(error) == "[LDAP_GROUP_ERROR] Group operation failed | Operation: group_management"
        assert isinstance(error, FlextLDAPGroupError)
        assert isinstance(error, FlextLDAPError)

    def test_group_error_with_group_context(self) -> None:
        """Test FlextLDAPGroupError with group details."""
        # Setup REAL group context
        group_context = {
            "group_dn": "cn=developers,ou=groups,dc=example,dc=com",
            "cn": "developers",
            "description": "Development team",
            "members": [
                "cn=john,ou=users,dc=example,dc=com",
                "cn=jane,ou=users,dc=example,dc=com",
            ],
        }

        # Execute REAL group error with context
        error = FlextLDAPGroupError(
            "Group modification failed",
            group_dn=group_context["group_dn"],
            group_cn=group_context["cn"],
        )

        # Verify REAL group context handling
        expected_context = {
            "group_dn": "cn=developers,ou=groups,dc=example,dc=com",
            "group_cn": "developers",
        }
        assert error.ldap_context == expected_context
        assert error.operation == "group_management"

    def test_group_error_factory_methods(self) -> None:
        """Test FlextLDAPGroupError factory methods."""
        # Execute REAL factory methods
        error1 = FlextLDAPGroupError.for_group_not_found("REDACTED_LDAP_BIND_PASSWORDs")
        error2 = FlextLDAPGroupError.for_group_exists("developers")
        error3 = FlextLDAPGroupError.for_member_not_in_group(
            "cn=user,ou=users,dc=example,dc=com", "REDACTED_LDAP_BIND_PASSWORDs"
        )

        # Verify REAL factory method results
        assert "REDACTED_LDAP_BIND_PASSWORDs" in str(error1)
        assert isinstance(error1, FlextLDAPGroupError)

        assert "developers" in str(error2)
        assert isinstance(error2, FlextLDAPGroupError)

        assert "cn=user,ou=users,dc=example,dc=com" in str(error3)
        assert "REDACTED_LDAP_BIND_PASSWORDs" in str(error3)
        assert isinstance(error3, FlextLDAPGroupError)


class TestFlextLDAPValidationErrorRealCoverage(unittest.TestCase):
    """Test FlextLDAPValidationError with real functionality coverage."""

    def test_validation_error_basic_creation(self) -> None:
        """Test FlextLDAPValidationError creation."""
        # Execute REAL validation error creation
        error = FlextLDAPValidationError("Validation failed")

        # Verify REAL validation error properties
        assert str(error) == "[LDAP_VALIDATION_ERROR] Validation failed | Operation: validation"
        assert isinstance(error, FlextLDAPValidationError)
        assert isinstance(error, FlextLDAPError)

    def test_validation_error_with_field_context_DISABLED(self) -> None:
        """Test FlextLDAPValidationError with validation details."""
        # Setup REAL validation context
        validation_context = {
            "field": "mail",
            "value": "invalid-email",
            "expected_format": "RFC 822 email format",
            "validation_rule": "email_format",
        }

        # Execute REAL validation error with available parameters  
        error = FlextLDAPValidationError(
            "Invalid email format",
            field_name="mail",
            field_value="invalid-email",
            validation_rule="email_format"
        )

        # Verify REAL validation error attributes
        assert error.field_name == "mail"
        assert error.field_value == "invalid-email"
        assert error.validation_rule == "email_format"
        assert "Invalid email format" in str(error)

    def test_validation_error_factory_methods(self) -> None:
        """Test FlextLDAPValidationError factory methods."""
        # Execute REAL factory methods
        error1 = FlextLDAPValidationError.for_missing_required_field("mail")
        error2 = FlextLDAPValidationError.for_invalid_dn_format("invalid-dn-format")
        error3 = FlextLDAPValidationError.for_invalid_filter_syntax("(invalid filter")

        # Verify REAL factory method results
        assert "mail" in str(error1)
        assert isinstance(error1, FlextLDAPValidationError)

        assert "invalid-dn-format" in str(error2)
        assert isinstance(error2, FlextLDAPValidationError)

        assert "(invalid filter" in str(error3)
        assert isinstance(error3, FlextLDAPValidationError)


class TestFlextLDAPConfigurationErrorRealCoverage(unittest.TestCase):
    """Test FlextLDAPConfigurationError with real functionality coverage."""

    def test_configuration_error_basic_creation(self) -> None:
        """Test FlextLDAPConfigurationError creation."""
        # Execute REAL configuration error creation
        error = FlextLDAPConfigurationError("Configuration error")

        # Verify REAL configuration error properties
        assert str(error) == "[LDAP_CONFIG_ERROR] Configuration error | Operation: configuration"
        assert isinstance(error, FlextLDAPConfigurationError)
        assert isinstance(error, FlextLDAPError)

    def test_configuration_error_with_config_context(self) -> None:
        """Test FlextLDAPConfigurationError with configuration details."""
        # Execute REAL configuration error with config parameters
        error = FlextLDAPConfigurationError(
            "Invalid port configuration",
            config_section="connection",
            config_key="server_port",
        )

        # Verify REAL configuration context handling
        assert error.ldap_context is not None
        assert error.operation == "configuration"

    def test_configuration_error_with_parameters(self) -> None:
        """Test FlextLDAPConfigurationError with all parameters."""
        # Execute REAL configuration error with parameters
        error1 = FlextLDAPConfigurationError(
            "Missing server config", config_key="server"
        )
        error2 = FlextLDAPConfigurationError(
            "Invalid port value", config_section="connection", config_key="port"
        )

        # Verify REAL parameter handling
        assert isinstance(error1, FlextLDAPConfigurationError)
        assert isinstance(error2, FlextLDAPConfigurationError)
        assert "server" in str(error1)
        assert "port" in str(error2)


class TestFlextLDAPTypeErrorRealCoverage(unittest.TestCase):
    """Test FlextLDAPTypeError with real functionality coverage."""

    def test_type_error_basic_creation(self) -> None:
        """Test FlextLDAPTypeError creation."""
        # Execute REAL type error creation
        error = FlextLDAPTypeError("Type error occurred")

        # Verify REAL type error properties
        assert str(error) == "[LDAP_TYPE_ERROR] Type error occurred | Operation: type_conversion"
        assert isinstance(error, FlextLDAPTypeError)
        assert isinstance(error, FlextLDAPError)

    def test_type_error_with_type_context(self) -> None:
        """Test FlextLDAPTypeError with type information."""
        # Setup REAL type context
        type_context = {
            "expected_type": "str",
            "actual_type": "int",
            "field": "server",
            "value": 389,
        }

        # Execute REAL type error with context
        error = FlextLDAPTypeError(
            "Expected string, got integer",
            ldap_context=type_context,
            operation="validate_types",
        )

        # Verify REAL type context handling
        assert error.ldap_context == type_context
        assert error.operation == "validate_types"

    def test_type_error_factory_methods(self) -> None:
        """Test FlextLDAPTypeError factory methods."""
        # Execute REAL FlextLDAPTypeError constructors
        error1 = FlextLDAPTypeError(
            "Invalid type for port", 
            expected_type="int", 
            actual_type="str",
            attribute_name="port"
        )
        error2 = FlextLDAPTypeError(
            "None value not allowed",
            attribute_name="server"
        )

        # Verify REAL type error results
        assert "port" in str(error1)
        assert isinstance(error1, FlextLDAPTypeError)
        assert "int" in str(error1)
        assert "str" in str(error1)

        assert "server" in str(error2)
        assert isinstance(error2, FlextLDAPTypeError)


class TestFlextLDAPExceptionFactoryRealCoverage(unittest.TestCase):
    """Test FlextLDAPExceptionFactory with real functionality coverage."""

    def test_exception_factory_connection_methods(self) -> None:
        """Test FlextLDAPExceptionFactory connection error creation."""
        # Execute REAL factory connection methods
        error1 = FlextLDAPExceptionFactory.connection_failed("ldap.example.com", 389)
        error2 = FlextLDAPExceptionFactory.connection_failed("ldap.example.com", "Connection timeout after 30s")
        error3 = FlextLDAPExceptionFactory.configuration_error("ssl_verify", "Certificate verification failed")

        # Verify REAL factory results
        assert isinstance(error1, FlextLDAPConnectionError)
        assert "ldap.example.com" in str(error1)
        assert "389" in str(error1)

        assert isinstance(error2, FlextLDAPConnectionError)
        assert "30" in str(error2)

        assert isinstance(error3, FlextLDAPConfigurationError)
        assert "Certificate verification failed" in str(error3)

    def test_exception_factory_authentication_methods(self) -> None:
        """Test FlextLDAPExceptionFactory authentication error creation."""
        # Execute REAL factory authentication methods
        error1 = FlextLDAPExceptionFactory.authentication_failed(
            "cn=REDACTED_LDAP_BIND_PASSWORD,dc=example,dc=com"
        )
        error2 = FlextLDAPExceptionFactory.authentication_failed(
            "cn=user,dc=example,dc=com"
        )

        # Verify REAL factory results
        assert isinstance(error1, FlextLDAPAuthenticationError)
        assert "cn=REDACTED_LDAP_BIND_PASSWORD,dc=example,dc=com" in str(error1)

        assert isinstance(error2, FlextLDAPAuthenticationError)
        assert "cn=user,dc=example,dc=com" in str(error2)
        assert "49" in str(error2)

    def test_exception_factory_search_methods(self) -> None:
        """Test FlextLDAPExceptionFactory search error creation."""
        # Execute REAL factory search methods
        error1 = FlextLDAPExceptionFactory.search_failed("ou=users,dc=example,dc=com")
        error2 = FlextLDAPExceptionFactory.filter_invalid("(invalidFilter")
        error3 = FlextLDAPExceptionFactory.size_limit_exceeded(1000)

        # Verify REAL factory results
        assert isinstance(error1, FlextLDAPSearchError)
        assert "ou=users,dc=example,dc=com" in str(error1)

        assert isinstance(error2, FlextLDAPSearchError)
        assert "(invalidFilter" in str(error2)

        assert isinstance(error3, FlextLDAPSearchError)
        assert "1000" in str(error3)

    def test_exception_factory_operation_methods(self) -> None:
        """Test FlextLDAPExceptionFactory operation error creation."""
        # Execute REAL factory operation methods
        error1 = FlextLDAPExceptionFactory.add_failed(
            "cn=newuser,ou=users,dc=example,dc=com"
        )
        error2 = FlextLDAPExceptionFactory.modify_failed(
            "cn=user,ou=users,dc=example,dc=com"
        )
        error3 = FlextLDAPExceptionFactory.delete_failed(
            "cn=olduser,ou=users,dc=example,dc=com"
        )

        # Verify REAL factory results
        assert isinstance(error1, FlextLDAPOperationError)
        assert "cn=newuser,ou=users,dc=example,dc=com" in str(error1)

        assert isinstance(error2, FlextLDAPOperationError)
        assert "cn=user,ou=users,dc=example,dc=com" in str(error2)

        assert isinstance(error3, FlextLDAPOperationError)
        assert "cn=olduser,ou=users,dc=example,dc=com" in str(error3)

    def test_exception_factory_validation_methods(self) -> None:
        """Test FlextLDAPExceptionFactory validation error creation."""
        # Execute REAL factory validation methods
        error1 = FlextLDAPExceptionFactory.validation_failed("mail", "invalid-email")
        error2 = FlextLDAPExceptionFactory.validation_failed("uid", "Required field missing")

        # Verify REAL factory results
        assert isinstance(error1, FlextLDAPValidationError)
        assert "mail" in str(error1)
        assert "invalid-email" in str(error1)

        assert isinstance(error2, FlextLDAPValidationError)
        assert "uid" in str(error2)

    def test_exception_factory_user_methods(self) -> None:
        """Test FlextLDAPExceptionFactory user error creation."""
        # Execute REAL factory methods that exist
        error1 = FlextLDAPExceptionFactory.search_failed("ou=users,dc=example,dc=com", "(uid=john.doe)", "User not found")
        error2 = FlextLDAPExceptionFactory.user_creation_failed("cn=jane.smith,ou=users,dc=example,dc=com", "User already exists")

        # Verify REAL factory results
        assert isinstance(error1, FlextLDAPSearchError)
        assert "john.doe" in str(error1)

        assert isinstance(error2, FlextLDAPUserError)  
        assert "jane.smith" in str(error2)

    def test_exception_factory_group_methods(self) -> None:
        """Test FlextLDAPExceptionFactory group error creation."""
        # Execute REAL factory methods that exist
        error1 = FlextLDAPExceptionFactory.authentication_failed("cn=REDACTED_LDAP_BIND_PASSWORD,dc=example,dc=com")
        error2 = FlextLDAPExceptionFactory.connection_failed("ldap://server:389", "Connection timeout")

        # Verify REAL factory results
        assert isinstance(error1, FlextLDAPAuthenticationError)
        assert "cn=REDACTED_LDAP_BIND_PASSWORD,dc=example,dc=com" in str(error1)

        assert isinstance(error2, FlextLDAPConnectionError)
        assert "Connection timeout" in str(error2)

    def test_exception_factory_configuration_methods(self) -> None:
        """Test FlextLDAPExceptionFactory configuration error creation."""
        # Execute REAL factory configuration methods
        error1 = FlextLDAPExceptionFactory.configuration_invalid("server")
        error2 = FlextLDAPExceptionFactory.config_file_not_found(
            "/etc/ldap/config.yaml"
        )

        # Verify REAL factory results
        assert isinstance(error1, FlextLDAPConfigurationError)
        assert "server" in str(error1)

        assert isinstance(error2, FlextLDAPConfigurationError)
        assert "/etc/ldap/config.yaml" in str(error2)


class TestExceptionHierarchyRealCoverage(unittest.TestCase):
    """Test exception hierarchy and inheritance with real functionality coverage."""

    def test_exception_hierarchy_inheritance(self) -> None:
        """Test all exceptions inherit from FlextLDAPError properly."""
        # Execute REAL inheritance testing for all exception types
        exceptions = [
            FlextLDAPConnectionError("test"),
            FlextLDAPAuthenticationError("test"),
            FlextLDAPSearchError("test"),
            FlextLDAPOperationError("test"),
            FlextLDAPUserError("test"),
            FlextLDAPGroupError("test"),
            FlextLDAPValidationError("test"),
            FlextLDAPConfigurationError("test"),
            FlextLDAPTypeError("test"),
        ]

        # Verify REAL inheritance for all exception types
        for exception in exceptions:
            assert isinstance(exception, FlextLDAPError)
            assert isinstance(exception, FlextExceptions.Error)
            assert isinstance(exception, Exception)

    def test_exception_hierarchy_polymorphism(self) -> None:
        """Test exception hierarchy supports polymorphism."""

        # Setup REAL polymorphic exception handling
        def handle_ldap_error(error: FlextLDAPError) -> str:
            return f"Handled: {type(error).__name__}: {error}"

        # Execute REAL polymorphic handling
        errors = [
            FlextLDAPConnectionError("Connection failed"),
            FlextLDAPAuthenticationError("Auth failed"),
            FlextLDAPSearchError("Search failed"),
        ]

        # Verify REAL polymorphic behavior
        for error in errors:
            result = handle_ldap_error(error)
            assert type(error).__name__ in result
            assert str(error) in result

    def test_exception_class_attributes(self) -> None:
        """Test exception classes have proper class attributes."""
        # Execute REAL class attribute verification
        exceptions_with_defaults = [
            FlextLDAPConnectionError,
            FlextLDAPAuthenticationError,
            FlextLDAPSearchError,
            FlextLDAPOperationError,
            FlextLDAPUserError,
            FlextLDAPGroupError,
            FlextLDAPValidationError,
            FlextLDAPConfigurationError,
            FlextLDAPTypeError,
        ]

        # Verify REAL class attributes exist
        for exception_class in exceptions_with_defaults:
            # Check if class has default messages or error codes
            assert hasattr(exception_class, "__name__")
            assert hasattr(exception_class, "__module__")
            assert hasattr(exception_class, "__doc__")


if __name__ == "__main__":
    unittest.main()
