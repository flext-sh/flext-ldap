version: '3.8'

services:
  flext-oud-test:
    image: harbor.datacosmos.com.br/ocr/middleware/oud:14.1.2.1.0-jdk17-ol8-250314
    container_name: flext-oud-test
    hostname: flext-oud-test
    ports:
      - "3489:1389"  # LDAP port
      - "3637:1636"  # LDAPS port (changed from 3636 to avoid conflict)
    environment:
      # OUD Configuration
      rootUserDN: "cn=admin"
      rootUserPassword: "admin123"
      baseDN: "dc=flext,dc=local"
      adminConnectorPort: "4444"
      ldapPort: "1389"
      ldapsPort: "1636"
      httpPort: "8080"
      httpsPort: "8443"
      jmxPort: "1689"

      # Sample data
      sampleData: "0"

      # Memory settings
      JAVA_OPTIONS: "-Xms512m -Xmx1024m"
    volumes:
      - oud-data:/u01/oracle/user_projects
    healthcheck:
      test: ["CMD", "ldapsearch", "-H", "ldap://localhost:1389", "-D", "cn=admin", "-w", "admin123", "-b", "dc=flext,dc=local", "-s", "base", "(objectClass=*)"]
      interval: 30s
      timeout: 10s
      retries: 5
      start_period: 120s
    networks:
      - flext-ldap-test

volumes:
  oud-data:
    driver: local

networks:
  flext-ldap-test:
    driver: bridge
